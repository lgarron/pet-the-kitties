<html manifest="files/cache.manifest">
<head>
  <title>Pet the Kitties</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="minimal-ui" />
  <link rel="stylesheet" href="files/cat.css">
  <link rel="apple-touch-icon" href="apple-touch-icon.jpg" />
  <!-- <script src="fastclick.js"></script> -->
</head>
<body>
<!-- <div id="cat-feed"></div> -->
<!-- <div id="cat-view"></div> -->
<div id="cat-stream"></div>
<div id="preload"></div>
<script>

/*

TODO:
- stream (single image at a time)
- music/purring
- pause GIF on current frame
- vertical vs. horizontal
*/


var cats = [
  "paw-licking",
  "lion-cat",
  "cat-catching-plush",
  "banana-cat",
  "cat-hugs-his-teddy-bear",
  "wobble-cat"
];


var loadCatStream = function() {
  console.log("Creating cat stream.");
  var catStream = document.getElementById("cat-stream");

  var randomCat = function() {
    return cats[Math.floor(Math.random() * cats.length)];
  }

  // var currentCat = randomCat();
  var currentCat = "wobble-cat";

  var preload = document.getElementById("preload");
  function setCatBackground() {
    console.log("Setting cat: " + currentCat);
    catStream.style.backgroundImage = "url(gif/" + currentCat + ".jpg)";
    preload.style.backgroundImage = "url(gif/" + currentCat + ".gif)";
  }

  setCatBackground();

  var newCat = function() {
    var prevCat = currentCat;
    while (prevCat === currentCat) {
      currentCat = randomCat();
    }
    setCatBackground();
  }


  var animate = function(e) {
    catStream.style.backgroundImage = "url(gif/" + currentCat + ".gif)";
  }

  var halt = function(e) {
    catStream.style.backgroundImage = "url(gif/" + currentCat + ".jpg)";
  }

  var preventDefault = function(e) {
    e.preventDefault();
  }

  var lastAnimationTime;
  var animationTimeoutMs = 100;
  var lastNewCatTime;
  var newCatTimeoutMs = 1000;

  var animationTimeout = function() {
    var currentTime = new Date().getTime();
    if (lastAnimationTime + animationTimeoutMs*0.99 < currentTime) {
      lastAnimationTime = currentTime;
      halt();
    }
  }

  var newCatTimeout = function() {
    var currentTime = new Date().getTime();
    if (lastNewCatTime + newCatTimeoutMs*0.99 < currentTime) {
      lastNewCatTime = currentTime;
      newCat();
    }
  }

  var touchmove = function(e) {
    animate();
    lastAnimationTime = new Date().getTime();
    lastNewCatTime = new Date().getTime();
    setTimeout(animationTimeout, animationTimeoutMs);
    setTimeout(newCatTimeout, newCatTimeoutMs);
    e.preventDefault();
  }

  // catPanel.addEventListener("touchstart", preventDefault);
  // catPanel.addEventListener("touchend", halt);
  // catPanel.addEventListener("mousedown", animate);
  // catPanel.addEventListener("mouseup", halt);

  catStream.addEventListener("touchmove", touchmove);
  // catPanel.addEventListener("mousemove", mousemove);

  console.log("Created cat stream.");
}

var loadCatFeed = function() {
  console.log("Loading.");
  // var images = ["DSC00801.jpg", "IMG_4474.jpg", "IMG_4481.jpg", "IMG_4488.jpg", "IMG_4499.jpg", "IMG_4509.jpg"
  //, "IMG_4533.jpg", "IMG_4567.jpg", "IMG_4585.jpg", "IMG_4590.jpg", "IMG_4591.jpg", "IMG_4595.jpg", "IMG_5440.jpg", "IMG_5454.jpg", "IMG_5525.jpg", "IMG_5526.jpg", "IMG_5558.jpg", "IMG_5564.jpg", "IMG_5569.jpg", "IMG_5572.jpg", "IMG_5587.jpg", "IMG_7593.jpg", "IMG_7606.jpg", "IMG_7617.jpg", "IMG_7625.jpg", "IMG_7633.jpg"
  // ];


  // for (image in images) {
    // var img = document.createElement("img");
    // img.src = "thumb/" + images[image];
    // img.alt = ["Awwwww.", "Pet me!", "mrrrow"][Math.floor(Math.random() * 3)];
    // document.getElementById("cat-feed").appendChild(img);
    // addImage(images[image]);
  // }
};

var loadCatView = function(cat) {
  // var img = document.createElement("img");
  document.body.style.backgroundImage = "url(thumb/" + cat + ")";
  // img.alt = ["Awwwww.", "Pet me!", "mrrrow"][Math.floor(Math.random() * 3)];
  // appendChild(img);
}

var loadCatGif = function(cat) {
  // var img = document.createElement("img");
  document.body.style.backgroundImage = "url(gif/paw-licking.jpg)";
  // img.alt = ["Awwwww.", "Pet me!", "mrrrow"][Math.floor(Math.random() * 3)];
  // appendChild(img);
}

// var touchstart = function() {
//   document.body.style.backgroundImage = "url(gif/paw-licking.gif)";
//   console.log("touchstart");
// }

// var touchend = function() {
//   document.body.style.backgroundImage = "url(gif/paw-licking.jpg)";
//   console.log("touchend");
// }

// document.body.addEventListener("touchstart", touchstart);
// document.body.addEventListener("touchend", touchend);

// document.body.onload = loadCatFeed;
document.body.onload = loadCatStream;
</script>
</body>
</html>